<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Express SPA Demo - Auth Middleware</title>
    <link href="/css/output.css" rel="stylesheet">
</head>
<body class="bg-gray-200">
<div class="container mx-auto p-4">
    <h1 class="text-2xl font-bold mb-4">Aristocrat Messenger (SPA Demo)</h1>
    <nav class="mb-4 space-x-2">
        <button
                onclick="loadPartial('/partials/home')"
                class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
        >
            Home
        </button>
        <button
                onclick="loadPartial('/partials/profile')"
                class="!bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"
        >
            Profile (Protected)
        </button>
        <button
                onclick="loadPartial('/partials/profile?authenticated=true')"
                class="bg-teal-500 hover:bg-teal-700 text-white font-bold py-2 px-4 rounded"
        >
            Profile (Simulate Auth)
        </button>
        <button
                onclick="loadPartial('/partials/login')"
                class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"
        >
            Login View
        </button>
    </nav>

    <div id="content" class="bg-white p-6 rounded shadow-md min-h-[200px]">
        <p>Click a button above to load content.</p>
    </div>
</div>

<script>
    const contentDiv = document.getElementById('content');

    async function loadPartial(url) {
        console.log(`Attempting to load partial: ${url}`);
        contentDiv.innerHTML = '<p class="text-gray-500">Loading...</p>'; // Show loading indicator

        try {
            const res = await fetch(url);

            if (res.ok) { // Status 200-299
                const html = await res.text();
                contentDiv.innerHTML = html;
                console.log(`Successfully loaded partial: ${url}`);
            } else if (res.status === 401) { // Authentication required
                console.warn(`Authentication required for ${url}. Loading login partial.`);
                // Automatically load the login partial instead
                await loadPartial('/partials/login'); // Recursively call to load login
            } else {
                // Handle other errors (e.g., 404 Not Found, 500 Server Error)
                contentDiv.innerHTML = `<p class="text-red-500">Error loading content: ${res.status} ${res.statusText}</p>`;
                console.error(`Error loading partial ${url}:`, res.status, res.statusText);
            }
        } catch (err) {
            contentDiv.innerHTML = '<p class="text-red-500">Network error or server unavailable.</p>';
            console.error('Fetch error:', err);
        }
    }

    // Optional: Load initial partial on page load (e.g., home)
    // document.addEventListener('DOMContentLoaded', () => {
    //   loadPartial('/partials/home');
    // });

</script>
</body>
</html>